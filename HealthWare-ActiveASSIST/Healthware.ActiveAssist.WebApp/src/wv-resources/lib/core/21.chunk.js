/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{381:function(Da,xa,z){z.r(xa);var na=z(2),ia=z(13),ka=z(1);Da=z(46);var ea=z(31),da=z(10);z=function(){function x(){this.init()}x.prototype.init=function(){this.K_=!1;this.Sf=this.gk=this.connection=null;this.hq={};this.na=this.XB=null};x.prototype.uda=function(r){for(var n=this,a=0;a<r.length;++a){var b=r[a];switch(b.at){case "create":this.hq[b.author]||(this.hq[b.author]=b.aName);this.h6(b);break;case "modify":this.na.wm(b.xfdf).then(function(f){n.na.yb(f[0])});
break;case "delete":this.na.wm("<delete><id>"+b.aId+"</id></delete>")}}};x.prototype.h6=function(r){var n=this;this.na.wm(r.xfdf).then(function(a){a=a[0];a.authorId=r.author;n.na.yb(a);n.na.trigger(ia.a.UPDATE_ANNOTATION_PERMISSION,[a])})};x.prototype.K5=function(r,n,a){this.gk&&this.gk(r,n,a)};x.prototype.preloadAnnotations=function(r){this.addEventListener("webViewerServerAnnotationsEnabled",this.K5.bind(this,r,"add",{imported:!1}),{once:!0})};x.prototype.initiateCollaboration=function(r,n,a){var b=
this;if(r){b.Sf=n;b.na=a.ua();a.addEventListener(ia.c.DOCUMENT_UNLOADED,function(){b.disableCollaboration()});b.Sda(r);var f=new XMLHttpRequest;f.addEventListener("load",function(){if(200===f.status&&0<f.responseText.length)try{var h=JSON.parse(f.responseText);b.connection=exports.kb.rea(Object(ea.i)(b.Sf,"blackbox/"),"annot");b.XB=h.id;b.hq[h.id]=h.user_name;b.na.tI(h.id);b.connection.WI(function(y){y.t&&y.t.startsWith("a_")&&y.data&&b.uda(y.data)},function(){b.connection.send({t:"a_retrieve",dId:r});
b.trigger(x.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[b.hq[h.id],b.XB])},function(){b.disableCollaboration()})}catch(y){Object(ka.f)(y.message)}});f.open("GET",Object(ea.i)(this.Sf,"demo/SessionInfo.jsp"));f.withCredentials=!0;f.send();b.K_=!0;b.na.kT(function(h){return b.hq[h.Author]||h.Author})}else Object(ka.f)("Document ID required for collaboration")};x.prototype.disableCollaboration=function(){this.gk&&(this.na.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.gk),this.gk=null);this.connection&&
this.connection.TE();this.na&&this.na.tI("Guest");this.init();this.trigger(x.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};x.prototype.Sda=function(r){var n=this;this.gk&&this.na.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.gk);this.gk=function(a,b,f){return Object(na.b)(this,void 0,void 0,function(){var h,y,e,w,aa,fa,ja,ba,ha;return Object(na.d)(this,function(ca){switch(ca.label){case 0:if(f.imported)return[2];h={t:"a_"+b,dId:r,annots:[]};return[4,n.na.gO()];case 1:y=ca.ga();"delete"!==
b&&(e=(new DOMParser).parseFromString(y,"text/xml"),w=new XMLSerializer);for(aa=0;aa<a.length;aa++)fa=a[aa],ba=ja=void 0,"add"===b?(ja=e.querySelector('[name="'+fa.Id+'"]'),ba=w.serializeToString(ja),ha=null,fa.InReplyTo&&(ha=n.na.lg(fa.InReplyTo).authorId||"default"),h.annots.push({at:"create",aId:fa.Id,author:n.XB,aName:n.hq[n.XB],parent:ha,xfdf:"<add>"+ba+"</add>"})):"modify"===b?(ja=e.querySelector('[name="'+fa.Id+'"]'),ba=w.serializeToString(ja),h.annots.push({at:"modify",aId:fa.Id,xfdf:"<modify>"+
ba+"</modify>"})):"delete"===b&&h.annots.push({at:"delete",aId:fa.Id});0<h.annots.length&&n.connection.send(h);return[2]}})})}.bind(n);this.na.addEventListener(da.a.Events.ANNOTATION_CHANGED,this.gk)};x.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return x}();Object(Da.a)(z);xa["default"]=z}}]);}).call(this || window)
